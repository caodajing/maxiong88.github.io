(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{418:function(a,t,s){"use strict";s.r(t);var e=s(43),r=Object(e.a)({},function(){var a=this,t=a.$createElement,s=a._self._c||t;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("p",[a._v("起因：\n公司项目有一个邮件系统，每天定时给员工发送邮件；\n我使用"),s("code",[a._v("express、multer、webpack、jquery、js-xlsx、phantom、node-cron、moment")]),a._v("做了一个简易版的；\n问题来了，我使用ajax提交xls文件超了180kb，以后node服务器相应失败，传小文件可以，然后我就一脸蒙蔽，因为在我本地是可以的，因为有运维妹子，所以服务器不归我们。今天就屁颠屁颠的跑去各种找原因，换启动方式、加内存等这不是解决问题的根本方法，找到总监一看我去原来是因为pm2这个狗东西。强行解释一波，只要服务器上面文件有改动，pm2就会重启就是这么简单，因为有时间间隔，所以小文件基本不会出现这个显现，但是已超过大小问题就暴露出来了，文件修改服务器重启就是这个。")]),a._v(" "),s("p",[a._v("我们是把文件上传的目录与下载的目录是跟项目放在一起的，并没有存放到临时文件中，当文件post到了上传目录中我们转换了临时文件并拷贝到下载目录中，pm2知道了文件修改，于是重启了服务导致上传失败，接口爆出404.")]),a._v(" "),s("p",[a._v("pm2 api很丰富、解决办法就是通过"),s("code",[a._v("--ignore-watch")]),a._v(" 排除监听的目录/文件，可以是特定的文件名，也可以是正则.")]),a._v(" "),s("div",{staticClass:"tip custom-block"},[s("p",{staticClass:"custom-block-title"},[a._v("TIP")]),a._v(" "),s("p",[a._v('命令式输入 可能很严谨 标点符号输入错误 也会导致服务不起作用\npm2 start app.js --watch --ignore-watch="test upload db"')])]),a._v(" "),s("p",[a._v("接下来我们简单说一下pm2.")]),a._v(" "),s("h2",{attrs:{id:"讲义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#讲义","aria-hidden":"true"}},[a._v("#")]),a._v(" 讲义")]),a._v(" "),s("p",[a._v("pm2是node进程管理工具，可以利用它来简化很多node应用管理的繁琐任务，如性能监控、自动重启、负载均衡等，而且使用非常简单。")]),a._v(" "),s("h2",{attrs:{id:"安装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装","aria-hidden":"true"}},[a._v("#")]),a._v(" 安装")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("npm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" -g pm2\n")])])]),s("h2",{attrs:{id:"启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动","aria-hidden":"true"}},[a._v("#")]),a._v(" 启动")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("pm2 start app.js\n")])])])])},[],!1,null,null,null);t.default=r.exports}}]);