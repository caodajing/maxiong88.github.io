<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>了解一下call apply bind | 雄大家</title>
    <meta name="description" content="来了解一下call apply bind">
    
    
    <link rel="preload" href="/assets/css/0.styles.d26378bb.css" as="style"><link rel="preload" href="/assets/js/app.6a1c7d67.js" as="script"><link rel="preload" href="/assets/js/2.63e202d5.js" as="script"><link rel="preload" href="/assets/js/8.00ec34fe.js" as="script"><link rel="prefetch" href="/assets/js/10.45b3122b.js"><link rel="prefetch" href="/assets/js/11.ef1e40ed.js"><link rel="prefetch" href="/assets/js/12.fd10a6de.js"><link rel="prefetch" href="/assets/js/13.deeea89e.js"><link rel="prefetch" href="/assets/js/14.2750bbe8.js"><link rel="prefetch" href="/assets/js/15.3699038f.js"><link rel="prefetch" href="/assets/js/16.47b9f8b3.js"><link rel="prefetch" href="/assets/js/17.725f6bb8.js"><link rel="prefetch" href="/assets/js/18.b0157e81.js"><link rel="prefetch" href="/assets/js/19.6c67f5dc.js"><link rel="prefetch" href="/assets/js/20.0e515db8.js"><link rel="prefetch" href="/assets/js/21.43d7f922.js"><link rel="prefetch" href="/assets/js/22.dfea0c59.js"><link rel="prefetch" href="/assets/js/23.c3bc28d6.js"><link rel="prefetch" href="/assets/js/24.57db548b.js"><link rel="prefetch" href="/assets/js/25.e2e9ffd9.js"><link rel="prefetch" href="/assets/js/26.e61851e1.js"><link rel="prefetch" href="/assets/js/27.be5d5f2c.js"><link rel="prefetch" href="/assets/js/28.ef903b6a.js"><link rel="prefetch" href="/assets/js/29.d65ee59a.js"><link rel="prefetch" href="/assets/js/3.018261d8.js"><link rel="prefetch" href="/assets/js/30.862d472d.js"><link rel="prefetch" href="/assets/js/31.a903b7be.js"><link rel="prefetch" href="/assets/js/32.17604038.js"><link rel="prefetch" href="/assets/js/33.b403c19c.js"><link rel="prefetch" href="/assets/js/34.2df7b623.js"><link rel="prefetch" href="/assets/js/35.04c1b42c.js"><link rel="prefetch" href="/assets/js/36.5775796d.js"><link rel="prefetch" href="/assets/js/37.6847ce80.js"><link rel="prefetch" href="/assets/js/38.956dd45b.js"><link rel="prefetch" href="/assets/js/39.d47fb572.js"><link rel="prefetch" href="/assets/js/4.539838e3.js"><link rel="prefetch" href="/assets/js/40.a460de13.js"><link rel="prefetch" href="/assets/js/41.5ad88ba8.js"><link rel="prefetch" href="/assets/js/42.a4740b36.js"><link rel="prefetch" href="/assets/js/43.22b59fb2.js"><link rel="prefetch" href="/assets/js/44.48fcb2a1.js"><link rel="prefetch" href="/assets/js/45.88b2df56.js"><link rel="prefetch" href="/assets/js/46.a4c14c43.js"><link rel="prefetch" href="/assets/js/47.ea4798bc.js"><link rel="prefetch" href="/assets/js/48.0cd6076d.js"><link rel="prefetch" href="/assets/js/49.13df7e3e.js"><link rel="prefetch" href="/assets/js/5.9f59a17f.js"><link rel="prefetch" href="/assets/js/50.6d65c345.js"><link rel="prefetch" href="/assets/js/51.06f54f5d.js"><link rel="prefetch" href="/assets/js/52.c91d91d2.js"><link rel="prefetch" href="/assets/js/53.de3c77b4.js"><link rel="prefetch" href="/assets/js/54.68e5267a.js"><link rel="prefetch" href="/assets/js/55.c852d2ba.js"><link rel="prefetch" href="/assets/js/56.d69fbe04.js"><link rel="prefetch" href="/assets/js/57.b45b29c6.js"><link rel="prefetch" href="/assets/js/58.69f6c5d4.js"><link rel="prefetch" href="/assets/js/59.43ab7236.js"><link rel="prefetch" href="/assets/js/6.04b98662.js"><link rel="prefetch" href="/assets/js/7.4446acf3.js"><link rel="prefetch" href="/assets/js/9.a50c4a40.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d26378bb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">雄大家</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">参考</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.h5anli.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  H5案例
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/blog/.html" class="nav-link">vue-weibo</a></li><li class="dropdown-item"><!----> <a href="/blog/.html" class="nav-link">vue-cms</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">MEME</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">Home</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">博客</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">参考</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.h5anli.com/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  H5案例
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="/blog/.html" class="nav-link">vue-weibo</a></li><li class="dropdown-item"><!----> <a href="/blog/.html" class="nav-link">vue-cms</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">MEME</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>了解一下call apply bind</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/js-this-call.html#神秘的-this" class="sidebar-link">神秘的 this</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/js-this-call.html#函数" class="sidebar-link">函数</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#构造函数" class="sidebar-link">构造函数</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#普通函数" class="sidebar-link">普通函数</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#构造函数与普通函数区别" class="sidebar-link">构造函数与普通函数区别</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#函数调用" class="sidebar-link">函数调用</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#this在函数调用中" class="sidebar-link">this在函数调用中</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#this在函数调用中，严格模式" class="sidebar-link">this在函数调用中，严格模式</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#陷阱：this内在的功能" class="sidebar-link">陷阱：this内在的功能</a></li></ul></li><li><a href="/blog/js-this-call.html#method-invocation-方法调" class="sidebar-link">Method invocation 方法调</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#this在方法调用中" class="sidebar-link">this在方法调用中</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#将方法与其对象分离" class="sidebar-link">将方法与其对象分离</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#constructor-invocation-构造函数调用：" class="sidebar-link">Constructor invocation 构造函数调用：</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#this在构造函数调用中" class="sidebar-link">this在构造函数调用中</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#忘记了new" class="sidebar-link">忘记了new</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#indirect-invocation-间接调用" class="sidebar-link">Indirect invocation 间接调用</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#this-in-indirect-invocation-间接调用中的this" class="sidebar-link">this in indirect invocation 间接调用中的this</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#bound-function" class="sidebar-link">Bound function</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#ployfill" class="sidebar-link">ployfill</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#this-in-bound-function-绑定函数中的this" class="sidebar-link">this in bound function 绑定函数中的this</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#tight-context-binding-紧密绑定上下文" class="sidebar-link">Tight context binding 紧密绑定上下文</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#polyfillbind" class="sidebar-link">polyfillBind</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#箭头函数" class="sidebar-link">箭头函数</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#箭头函数功能" class="sidebar-link">箭头函数功能</a></li><li class="sidebar-sub-header"><a href="/blog/js-this-call.html#陷阱：用箭头函数定义方法" class="sidebar-link">陷阱：用箭头函数定义方法</a></li></ul></li><li><a href="/blog/js-this-call.html#new运算符" class="sidebar-link">new运算符</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/js-this-call.html#结论" class="sidebar-link">结论</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="content default"><p><img src="/assets/img/bind-3.69079d76.jpg" alt="bind-3"></p> <h2 id="神秘的-this"><a href="#神秘的-this" aria-hidden="true" class="header-anchor">#</a> 神秘的 this</h2> <p>在JavaScript中：this是函数的当前执行上下文。该语言有4种函数调用类型：</p> <blockquote><p>函数调用： alert('Hello World!')
方法调用： console.log('Hello World!')
构造函数调用： new RegExp('\d')
间接调用： alert.call(undefined, 'Hello World!') alert.apply(null, ['helloe']) alert.bind(null, 'helloe')</p></blockquote> <p>每种调用类型都可以用自己的方式定义上下文</p> <h2 id="函数"><a href="#函数" aria-hidden="true" class="header-anchor">#</a> 函数</h2> <p>函数是由(js事件onclick onload等)事件驱动的或者当它被调用(function a(){} a()调用)时执行的可重复使用的代码块。</p> <h3 id="构造函数"><a href="#构造函数" aria-hidden="true" class="header-anchor">#</a> 构造函数</h3> <p>需要使用new运算符</p> <h3 id="普通函数"><a href="#普通函数" aria-hidden="true" class="header-anchor">#</a> 普通函数</h3> <p>不适用new运算符</p> <h3 id="构造函数与普通函数区别"><a href="#构造函数与普通函数区别" aria-hidden="true" class="header-anchor">#</a> 构造函数与普通函数区别</h3> <ol><li>构造函数使用new运算符调用；普通函数不使用new运算符调用；</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token function">Persion1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>2.构造函数内部可以使用this关键字；普通函数内部不建议使用this，因为这时候this指向的是window全局对象，这样无意间就会为window添加了一些全局变量或函数</p> <div class="language-bash extra-class"><pre class="language-bash"><code>2.1 在构造函数内部，this指向的是构造出来的新对象

2.2 在普通函数内部，this指向的是window全局对象
</code></pre></div><p>3.构造函数默认不用return返回值；普通函数一般都有return返回值</p> <div class="language-bash extra-class"><pre class="language-bash"><code>3.1 构造函数会默认返回this，也就是新的实例对象

3.2 普通函数如果没有return值的话，返回undefined

3.3 如果使用了return，那返回值会根据return值的类型而有所不同
3.3.1 return的是五种简单数据类型：String,Number,Boolean,Null,Undefined的话，构造函数会忽略return的值，依然返回this对象；而普通函数会返回return后面的值
3.3.2 如果return的是引用类型：Array,Date,Object,Function,RegExp,Error的话，构造函数和普通函数都会返回return后面的值
</code></pre></div><p>4.构造函数首字母建议大写；普通函数首字母建议小写</p> <h3 id="函数调用"><a href="#函数调用" aria-hidden="true" class="header-anchor">#</a> 函数调用</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">hello</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'!'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Function invocation</span>
<span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Hello World!' </span>

<span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token keyword">return</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> name <span class="token operator">+</span> <span class="token string">'!'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span> <span class="token comment">// =&gt; 'Hello World!'  </span>
</code></pre></div><h3 id="this在函数调用中"><a href="#this在函数调用中" aria-hidden="true" class="header-anchor">#</a> this在函数调用中</h3> <p>在函数调用中，执行上下文(this)是全局对象。<code>全局对象由执行环境决定。在浏览器中，它是window对象。</code></p> <p>让我们检查以下函数中的上下文：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>myNumber <span class="token operator">=</span> <span class="token number">20</span><span class="token punctuation">;</span> <span class="token comment">// 添加myNumber属性到全局对象中</span>
   <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// sum() 作为一个函数调用，内的this是一个全局对象 window</span>
<span class="token function">sum</span><span class="token punctuation">(</span><span class="token number">15</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// =&gt; 31  </span>
window<span class="token punctuation">.</span>myNumber<span class="token punctuation">;</span> <span class="token comment">// =&gt; 20  </span>
</code></pre></div><p>在sum(15, 16)调用时，JavaScript自动设置this为全局对象，在浏览器中window。</p> <p>当this在任何函数作用域之外使用时（最顶层的作用域：全局执行上下文），它还是引用全局对象：</p> <div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true  </span>
<span class="token keyword">this</span><span class="token punctuation">.</span>myString <span class="token operator">=</span> <span class="token string">'Hello World!'</span><span class="token punctuation">;</span>  
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>myString<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Hello World!'  </span>

<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> In an html file <span class="token operator">--</span><span class="token operator">&gt;</span>  
<span class="token operator">&lt;</span>script type<span class="token operator">=</span><span class="token string">&quot;text/javascript&quot;</span><span class="token operator">&gt;</span>  
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>  
</code></pre></div><h3 id="this在函数调用中，严格模式"><a href="#this在函数调用中，严格模式" aria-hidden="true" class="header-anchor">#</a> this在函数调用中，严格模式</h3> <p>this是undefined在严格模式下的函数调用</p> <p>严格模式是在ECMAScript 5.1中引入的，它是JavaScript的限制变体。它提供更好的安全性和更强的错误检查。</p> <p>以严格模式执行的函数示例：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token string">'use strict'</span><span class="token punctuation">;</span> <span class="token comment">// enable the strict mode</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> undefined<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">return</span> a <span class="token operator">*</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// multiply() function invocation with strict mode enabled</span>
<span class="token comment">// this in multiply() is undefined</span>
<span class="token function">multiply</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 10  </span>
</code></pre></div><p>当multiply(2, 5)作为函数调用时，this是undefined。</p> <p>严格模式不仅在当前作用域中有效，而且在内部作用域中有效（对于在内部声明的所有函数）：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token string">'use strict'</span><span class="token punctuation">;</span> <span class="token comment">// activate the strict mode    </span>
   <span class="token keyword">function</span> <span class="token function">concat</span><span class="token punctuation">(</span>str1<span class="token punctuation">,</span> str2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// the strict mode is enabled too</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> undefined<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
     <span class="token keyword">return</span> str1 <span class="token operator">+</span> str2<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token comment">// concat() is invoked as a function in strict mode</span>
   <span class="token comment">// this in concat() is undefined</span>
   <span class="token function">concat</span><span class="token punctuation">(</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">' World!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; &quot;Hello World!&quot;</span>
<span class="token punctuation">}</span>
<span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>单个JavaScript文件可能包含严格和非严格模式。因此，对于相同的调用类型，可以在单个脚本中具有不同的上下文行为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">nonStrictSum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token comment">// non-strict mode</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">strictSum</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token string">'use strict'</span><span class="token punctuation">;</span>
  <span class="token comment">// strict mode is enabled</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> undefined<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// nonStrictSum() is invoked as a function in non-strict mode</span>
<span class="token comment">// this in nonStrictSum() is the window object</span>
<span class="token function">nonStrictSum</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 11  </span>
<span class="token comment">// strictSum() is invoked as a function in strict mode</span>
<span class="token comment">// this in strictSum() is undefined</span>
<span class="token function">strictSum</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 20  </span>
</code></pre></div><h3 id="陷阱：this内在的功能"><a href="#陷阱：this内在的功能" aria-hidden="true" class="header-anchor">#</a> 陷阱：this内在的功能</h3> <div class="language-tip extra-class"><pre class="language-text"><code>
	内部函数的上下文仅取决于调用，而不取决于外部函数的上下文

</code></pre></div><p>为了获得预期this，使用间接调用修改内部函数的上下文（使用.call()或.apply()）或创建绑定函数（使用.bind()）。</p> <p>以下示例计算两个数字的总和：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span>  
   numberA<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
   numberB<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
   sum<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
     <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// this is window or undefined in strict mode</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; false</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberA <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberB<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
numbers<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; NaN or throws TypeError in strict mode  </span>
</code></pre></div><p>numbers.sum()是对象的方法调用，因此sum()上下文是numbers对象。</p> <p>calculate函数是在sum函数内定义，所以你可能也希望calculate的上下文也是sum。</p> <p>然而，它calculate()是一个函数调用（但不是方法调用），它具有this全局对象window或undefined严格模式。即使外部函数sum将上下文作为numbers对象，它也没有影响。</p> <p>在严格模式下抛出numbers.sum()is NaN或错误的调用结果TypeError: Cannot read property 'numberA' of undefined。绝对不是预期的结果5 + 10 = 15，因为calculate没有正确调用。</p> <p>要解决此问题，calculate应使用与sum方法相同的上下文执行函数，以便访问numberA和numberB属性。</p> <p>一种解决方案是calculate通过调用calculate.call(this)（间接调用函数，）手动将上下文更改为所需的上下文。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span>  
   numberA<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
   numberB<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
   sum<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
     <span class="token keyword">function</span> <span class="token function">calculate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
       <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberA <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>numberB<span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
     <span class="token comment">// use .call() method to modify the context</span>
     <span class="token keyword">return</span> calculate<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
numbers<span class="token punctuation">.</span><span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 15  </span>
</code></pre></div><p>calculate.call(this),改变了calculate this指向，并调用
现在this.numberA + this.numberB相当于numbers.numberA + numbers.numberB。该函数返回预期的结果5 + 10 = 15。</p> <h2 id="method-invocation-方法调"><a href="#method-invocation-方法调" aria-hidden="true" class="header-anchor">#</a> Method invocation 方法调</h2> <p>方法是存储在对象属性中的函数。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myObject <span class="token operator">=</span> <span class="token punctuation">{</span>  
  <span class="token comment">// helloFunction is a method</span>
  helloFunction<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">'Hello World!'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> message <span class="token operator">=</span> myObject<span class="token punctuation">.</span><span class="token function">helloFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><p>helloFunction是myObject的方法。要获取该方法，请使用属性访问器：myObject.helloFunction。</p> <p>以下调用列表显示了如何区分这些类型：函数调用 与 方法调用</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">[</span><span class="token string">'Hello'</span><span class="token punctuation">,</span> <span class="token string">'World'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">', '</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// method invocation</span>
<span class="token punctuation">(</span><span class="token punctuation">{</span> ten<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ten</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// method invocation</span>
<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>  
obj<span class="token punctuation">.</span><span class="token function-variable function">myFunction</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
obj<span class="token punctuation">.</span><span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// method invocation</span>

<span class="token keyword">var</span> otherFunction <span class="token operator">=</span> obj<span class="token punctuation">.</span>myFunction<span class="token punctuation">;</span>  
<span class="token function">otherFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">// function invocation  </span>
<span class="token function">parseFloat</span><span class="token punctuation">(</span><span class="token string">'16.60'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// function invocation  </span>
<span class="token function">isNaN</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">// function invocation  </span>
</code></pre></div><p>理解函数调用和方法调用之间的区别有助于正确识别上下文。</p> <h3 id="this在方法调用中"><a href="#this在方法调用中" aria-hidden="true" class="header-anchor">#</a> this在方法调用中</h3> <p>在对象上调用方法时，this成为对象本身。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> calc <span class="token operator">=</span> <span class="token punctuation">{</span>  
  num<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
  increment<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> calc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>num <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// method invocation. this is calc</span>
calc<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 1  </span>
calc<span class="token punctuation">.</span><span class="token function">increment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 2  </span>
</code></pre></div><p>让我们来看另一个案例。JavaScript对象从其继承方法prototype。在对象上调用继承的方法时，调用的上下文仍然是对象本身：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myDog <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span>  
  sayName<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> myDog<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
     <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
myDog<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'Milo'</span><span class="token punctuation">;</span>  
<span class="token comment">// method invocation. this is myDog</span>
myDog<span class="token punctuation">.</span><span class="token function">sayName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Milo'  </span>

</code></pre></div><p>Object.create()创建一个新对象myDog并设置原型。myDog对象继承sayName方法。
何时myDog.sayName()执行，myDog是调用的上下文。</p> <p>在ECMAScript 6 class语法中，方法调用上下文也是实例本身：</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">class</span> <span class="token class-name">Planet</span> <span class="token punctuation">{</span>  
  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>
  <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> earth<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> earth <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Planet</span><span class="token punctuation">(</span><span class="token string">'Earth'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// method invocation. the context is earth</span>
earth<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Earth'  </span>
</code></pre></div><h3 id="将方法与其对象分离"><a href="#将方法与其对象分离" aria-hidden="true" class="header-anchor">#</a> 将方法与其对象分离</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> myObj <span class="token operator">=</span> <span class="token punctuation">{</span>
	myMethod<span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>将myObj对象的方法myMethod提取为分离的变量alone；</p> <p><code>var alone = myObj.myMethod</code>;</p> <p>单独调用alone方法，您可能会认为myMethod()内部的this是myObj对象。这是不对的</p> <p>而this是全局对象window或undefined严格模式.</p> <p>创建绑定函数var alone = myObj.myMethod.bind(myObj)（使用.bind()，）可以修复上下文，使其成为拥有该方法的对象。</p> <p>以下示例创建Animal构造函数并创建它的实例 - myCat。然后setTimout()在1秒后记录myCat对象信息：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> legs<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>legs <span class="token operator">=</span> legs<span class="token punctuation">;</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">logInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> myCat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; false</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' has '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>legs <span class="token operator">+</span> <span class="token string">' legs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> myCat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// logs &quot;The undefined has undefined legs&quot;</span>
<span class="token comment">// or throws a TypeError in strict mode</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>myCat<span class="token punctuation">.</span>logInfo<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><p>你可能认为setTimout会调用myCat.logInfo()，它应该记录有关myCat对象的信息。</p> <p>不幸的是，当作为参数传递时，该方法与其对象分离：setTimout(myCat.logInfo)。以下情况是等效的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">setTimout</span><span class="token punctuation">(</span>myCat<span class="token punctuation">.</span>logInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// is equivalent to:</span>
<span class="token keyword">var</span> extractedLogInfo <span class="token operator">=</span> myCat<span class="token punctuation">.</span>logInfo<span class="token punctuation">;</span>  <span class="token comment">// extractedLogInfo相当于函数调用而不是对象调用，执行上下文改变了</span>
<span class="token function">setTimout</span><span class="token punctuation">(</span>extractedLogInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><p>当logInfosplit作为函数调用时，this是全局对象或者undefined严格模式（但不是 myCat对象）。因此对象信息无法正确记录。</p> <p>函数可以使用.bind()方法与对象绑定。如果分离的方法与myCatobject 绑定，则解决了上下文问题：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Animal</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> legs<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>legs <span class="token operator">=</span> legs<span class="token punctuation">;</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function-variable function">logInfo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> myCat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'The '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">+</span> <span class="token string">' has '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>legs <span class="token operator">+</span> <span class="token string">' legs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> myCat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token string">'Cat'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// logs &quot;The Cat has 4 legs&quot;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span>myCat<span class="token punctuation">.</span>logInfo<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>myCat<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><p>myCat.logInfo.bind(myCat)返回一个新函数，该函数执行起来与logInfo一样，它的this是myCat。</p> <h3 id="constructor-invocation-构造函数调用："><a href="#constructor-invocation-构造函数调用：" aria-hidden="true" class="header-anchor">#</a> Constructor invocation 构造函数调用：</h3> <p>这个例子声明了一个函数Country，然后将它作为构造函数调用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Country</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> traveled<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
   <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name <span class="token operator">?</span> name <span class="token punctuation">:</span> <span class="token string">'United Kingdom'</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>traveled <span class="token operator">=</span> <span class="token function">Boolean</span><span class="token punctuation">(</span>traveled<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// transform to a boolean</span>
<span class="token punctuation">}</span>
Country<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">travel</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span>traveled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Constructor invocation</span>
<span class="token keyword">var</span> france <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Country</span><span class="token punctuation">(</span><span class="token string">'France'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// Constructor invocation</span>
<span class="token keyword">var</span> unitedKingdom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Country</span><span class="token punctuation">;</span>

france<span class="token punctuation">.</span><span class="token function">travel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Travel to France  </span>
</code></pre></div><p>new Country('France', false)是Country函数的构造函数调用。执行的结果是一个新对象，name 属性是'France'。
如果在没有参数的情况下调用构造函数，则可以省略括号对：new Country。</p> <p>从ECMAScript 2015开始，JavaScript允许使用class语法定义构造函数：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">City</span> <span class="token punctuation">{</span>  
  <span class="token function">constructor</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> traveled<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>traveled <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">travel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>traveled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Constructor invocation</span>
<span class="token keyword">var</span> paris <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">City</span><span class="token punctuation">(</span><span class="token string">'Paris'</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
paris<span class="token punctuation">.</span><span class="token function">travel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre></div><p>new City('Paris')是一个构造函数调用。对象初始化由类中的特殊方法处理：constructor具有this新创建的对象。</p> <p>构造函数调用创建一个空的新对象，该对象从构造函数的原型继承属性。构造函数的作用是初始化对象。</p> <h3 id="this在构造函数调用中"><a href="#this在构造函数调用中" aria-hidden="true" class="header-anchor">#</a> this在构造函数调用中</h3> <p><code>this是构造函数调用中新创建的对象</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Foo</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Foo</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>property <span class="token operator">=</span> <span class="token string">'Default Value'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Constructor invocation</span>
<span class="token keyword">var</span> fooInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
fooInstance<span class="token punctuation">.</span>property<span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Default Value'  </span>

<span class="token keyword">class</span> <span class="token class-name">Bar</span> <span class="token punctuation">{</span>  
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Bar</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>property <span class="token operator">=</span> <span class="token string">'Default Value'</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Constructor invocation</span>
<span class="token keyword">var</span> barInstance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
barInstance<span class="token punctuation">.</span>property<span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Default Value'  </span>
</code></pre></div><h3 id="忘记了new"><a href="#忘记了new" aria-hidden="true" class="header-anchor">#</a> 忘记了new</h3> <p>一些JavaScript函数不仅在作为构造函数调用时创建实例，而且在作为函数调用时也创建实例。例如RegExp：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> reg1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token string">'\\w+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token keyword">var</span> reg2 <span class="token operator">=</span> <span class="token function">RegExp</span><span class="token punctuation">(</span><span class="token string">'\\w+'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

reg1 <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; true  </span>
reg2 <span class="token keyword">instanceof</span> <span class="token class-name">RegExp</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; true  </span>
reg1<span class="token punctuation">.</span>source <span class="token operator">===</span> reg2<span class="token punctuation">.</span>source<span class="token punctuation">;</span> <span class="token comment">// =&gt; true  </span>
</code></pre></div><p>执行时new RegExp('\w+')，RegExp('\w+')JavaScript会创建等效的正则表达式对象。</p> <p>使用函数调用来创建对象是一个潜在的问题（不包括工厂模式），因为一些构造函数可能会忽略在new缺少关键字初始化对象的逻辑。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Vehicle</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> wheelsCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>wheelsCount <span class="token operator">=</span> wheelsCount<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Function invocation</span>
<span class="token keyword">var</span> car <span class="token operator">=</span> <span class="token function">Vehicle</span><span class="token punctuation">(</span><span class="token string">'Car'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
car<span class="token punctuation">.</span>type<span class="token punctuation">;</span>       <span class="token comment">// =&gt; 'Car'  </span>
car<span class="token punctuation">.</span>wheelsCount <span class="token comment">// =&gt; 4  </span>
car <span class="token operator">===</span> window  <span class="token comment">// =&gt; true  </span>
</code></pre></div><p>Vehicle是一个在上下文对象上设置type和wheelsCount属性的函数。返回
执行Vehicle('Car', 4)对象时car，它具有正确的属性：car.typeis 'Car'和car.wheelsCountis 4。您可能认为它适用于创建和初始化新对象。</p> <p>但是在函数调用中this是window对象,因为结果Vehicle('Car', 4)是在window对象上设置属性- 错误的场景。未创建新对象。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Vehicle</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> wheelsCount<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Vehicle</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">throw</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token string">'Error: Incorrect invocation'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>type <span class="token operator">=</span> type<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>wheelsCount <span class="token operator">=</span> wheelsCount<span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Constructor invocation</span>
<span class="token keyword">var</span> car <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vehicle</span><span class="token punctuation">(</span><span class="token string">'Car'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
car<span class="token punctuation">.</span>type               <span class="token comment">// =&gt; 'Car'  </span>
car<span class="token punctuation">.</span>wheelsCount        <span class="token comment">// =&gt; 4  </span>
car <span class="token keyword">instanceof</span> <span class="token class-name">Vehicle</span> <span class="token comment">// =&gt; true</span>

<span class="token comment">// Function invocation. Generates an error.</span>
<span class="token keyword">var</span> brokenCar <span class="token operator">=</span> <span class="token function">Vehicle</span><span class="token punctuation">(</span><span class="token string">'Broken Car'</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><p>new Vehicle('Car', 4) 效果很好：创建并初始化一个新对象，因为new 关键字存在于构造函数调用中。</p> <p>在构造函数中添加了验证：this instanceof Vehicle以确保执行上下文是正确的对象类型。</p> <p>如果this不是 Vehicle实例，则生成错误。</p> <p>每当Vehicle('Broken Car', 3)执行（没有new）时抛出异常：Error: Incorrect invocation。</p> <h3 id="indirect-invocation-间接调用"><a href="#indirect-invocation-间接调用" aria-hidden="true" class="header-anchor">#</a> Indirect invocation 间接调用</h3> <p><code>使用 call() 、 apply()方法调用函数时执行间接调用</code></p> <p>JavaScript中的函数是第一类对象，这意味着函数是一个对象。这个对象的类型是Function。</p> <div class="tip custom-block"><p class="custom-block-title">.call()和.apply()用于调用具有可配置上下文的函数:</p> <p>call方法（thisArg[，arg1[，arg2[，...]]]）接受第一个参数thisArg作为调用的上下文和
参数arg1、arg2、...的列表这些参数作为参数传递给调用函数。</p> <p>.apply方法(thisArg，[arg1，arg2，...])方法接受第一个参数thisArg作为调用的上下文，
并接受作为参数传递给被调用函数的值[arg1，arg2，...]的数组样对象。</p></div> <p>下面的示例演示了间接调用：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">increment</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> <span class="token operator">++</span>number<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
increment<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>undefined<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// =&gt; 11  </span>
increment<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>undefined<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 11  </span>
</code></pre></div><p>例如，两者之间的主要区别在于.call()接受参数列表myFun.call(thisValue, 'val1', 'val2')。
但是.apply()接受类似数组的对象中的值列表，例如myFunc.apply(thisValue, ['val1', 'val2'])。</p> <h3 id="this-in-indirect-invocation-间接调用中的this"><a href="#this-in-indirect-invocation-间接调用中的this" aria-hidden="true" class="header-anchor">#</a> this in indirect invocation 间接调用中的this</h3> <p><code>this在间接调用中是作为第一个参数传递给.call()或.apply()的值。</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> rabbit <span class="token operator">=</span> <span class="token punctuation">{</span> name<span class="token punctuation">:</span> <span class="token string">'White Rabbit'</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>  
<span class="token keyword">function</span> <span class="token function">concatName</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> rabbit<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">return</span> string <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// Indirect invocations</span>
concatName<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>rabbit<span class="token punctuation">,</span> <span class="token string">'Hello '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// =&gt; 'Hello White Rabbit'  </span>
concatName<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>rabbit<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">'Bye '</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Bye White Rabbit'  </span>
</code></pre></div><p>当函数作用在特定的上下文执行时，间接调用是有用的。
例如，用于解决函数调用的上下文问题，其中在严格模式下，它总是window或undefined</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">function</span> <span class="token function">Runner</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Rabbit</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>  
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Rabbit</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> countLegs<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">Rabbit</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token comment">// Indirect invocation. Call parent constructor.</span>
  Runner<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>countLegs <span class="token operator">=</span> countLegs<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> myRabbit <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Rabbit</span><span class="token punctuation">(</span><span class="token string">'White Rabbit'</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
myRabbit<span class="token punctuation">;</span> <span class="token comment">// { name: 'White Rabbit', countLegs: 4 } </span>
</code></pre></div><p>在Rabbit内部调用Runer.call(this, name)间接调用函数(Runer)来初始化对象。</p> <div class="tip custom-block"><p class="custom-block-title">总结：大白话</p> <p>Fun.call()、Fun.apply()种的第一个参数就是当前的上下文，
Fun变化就是：修改了自己的this，并且执行一遍</p></div> <h3 id="bound-function"><a href="#bound-function" aria-hidden="true" class="header-anchor">#</a> Bound function</h3> <p>bind() 函数会创建一个新绑定函数(bound function, BF).
绑定函数是一个exotic function object 怪异函数对象，他包装了原函数对象。
调用绑定函数通常会导致执行包装函数。</p> <pre><code>绑定函数具有以下内部属性
	1、[[BoundTargetFunction]] 包装的函数对象
	2、[[BoundThis]] 在调用包装函数时始终作为this值传递的值
	3、[[BoundArguments]] 参数列表
	4、[[Call]] 执行与此对象关联的代码
	
当调用绑定函数时，它调用[[BoundTagrtFunction]]上的内部方法[[Call]],
就像这个样Call(bounfThis, args).其中，boundThis是[[BoundThis]],args是[[BoundArguments]]加上通过函数调用传入的参数列表
</code></pre> <p><img src="/assets/img/bind-1.9fee4a9b.png" alt="bind-1"> <img src="/assets/img/bind-2.bcb09c9e.png" alt="bind-2"></p> <p>从上面console中可以看到c就是我们创建的一个新绑定函数bound function</p> <h3 id="ployfill"><a href="#ployfill" aria-hidden="true" class="header-anchor">#</a> ployfill</h3> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>bind<span class="token punctuation">)</span><span class="token punctuation">{</span>
	Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">bind</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>oThis<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> <span class="token keyword">this</span> <span class="token operator">!==</span> <span class="token string">'function'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'绑定者必须是函数'</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">var</span> aArgs <span class="token operator">=</span> Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 通过slice方法返回指定数组元素，不包括this 获取参数数组化</span>
		fToBind <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">,</span> 
		<span class="token function-variable function">fNOP</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// noop = function(){}</span>
		<span class="token function-variable function">fBound</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
			<span class="token comment">// this instanceof fBound === true 说明返回的fBound被当做new的构造函数调用  当前this是不是fBound的实例</span>
			<span class="token keyword">return</span> fToBind<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>
        <span class="token keyword">this</span> <span class="token keyword">instanceof</span> <span class="token class-name">fBound</span> <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token punctuation">:</span> oThis<span class="token punctuation">,</span>
				aArgs<span class="token punctuation">.</span><span class="token function">concat</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>slice<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token comment">// 获取调用时 fBound的传参 bind返回的函数入参往往是这么传递的</span>
			<span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 维护原型</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">{</span>
			fNOP<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>prototype
		<span class="token punctuation">}</span>
		<span class="token comment">// 下行代码使fBound.prototype是fNOP的实例</span>
		<span class="token comment">// 返回的fBound若作为new的构造函数，new生成的新对象作为this传入fBound，新对象的__proto__就是fNOP的实例</span>
		fBound<span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">fNOP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> fBound<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// https://github.com/lodash/lodash/blob/4.17.11/dist/lodash.js</span>
<span class="token comment">// https://github.com/ramda/ramda/blob/master/dist/ramda.js</span>
</code></pre></div><p>绑定函数通常它是由原始函数使用.bind()方法创建的。</p> <p>原始和绑定函数共享相同的代码和范围，但执行时的上下文不同。</p> <p>bind方法（thisArg[，arg1[，arg2[，...]]]）接受第一个参数thisArg作为调用时绑定函数的上下文
以及参数arg1、arg2、...的可选列表这些参数作为参数传递给调用函数。它返回一个与thisArg绑定的新函数。</p> <p>以下代码创建绑定函数，稍后调用它：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token string">'use strict'</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment">// true</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span> <span class="token operator">*</span> number<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// create a bound function with context</span>
<span class="token keyword">var</span> double <span class="token operator">=</span> multiply<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// invoke the bound function</span>
<span class="token function">double</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// =&gt; 6  </span>
<span class="token function">double</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 20  </span>
</code></pre></div><p>multiply.bind(2)返回一个新的函数对象(加倍函数)，它与数字2绑定。
乘法和加法具有相同的代码和范围。</p> <p>与.Apple()和.call()方法相反，它立即调用函数，.bind()方法只返回一个新函数，
该函数稍后将被调用，并对此进行预配置。</p> <h3 id="this-in-bound-function-绑定函数中的this"><a href="#this-in-bound-function-绑定函数中的this" aria-hidden="true" class="header-anchor">#</a> this in bound function 绑定函数中的this</h3> <p><code>当调用绑定函数时，this是.bind()的第一个参数。</code></p> <p>.bind()的作用是创建一个新函数，调用时其 <code>上下文</code> 为传递给.bind()的第一个参数。
它是一种强大的技术，允许创建具有预定义的这个值的函数。</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token punctuation">{</span>  
  array<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  getNumbers<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>array<span class="token punctuation">;</span>    
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// Create a bound function</span>
<span class="token keyword">var</span> boundGetNumbers <span class="token operator">=</span> numbers<span class="token punctuation">.</span>getNumbers<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token function">boundGetNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; [3, 5, 10]  </span>
numbers<span class="token punctuation">.</span><span class="token function">getNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// =&gt; [3, 5, 10]  </span>
<span class="token comment">// Extract method from object</span>
<span class="token keyword">var</span> simpleGetNumbers <span class="token operator">=</span> numbers<span class="token punctuation">.</span>getNumbers<span class="token punctuation">;</span>  
<span class="token function">simpleGetNumbers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; undefined or throws an error in strict mode </span>
</code></pre></div><p>numbers.getNumbers.bind(numbers) 返回一个以numbers对象为上下文的 boundGetNumbers新函数
然后调用boundGetNumbers()该函数的this指向 numbers对象,并返回正确的数组对象</p> <p>将numbers.getNumbers 提取到 simpleGetNumbers变量中而不进行绑定
对后来的调用simpleGetNumbers()具有this作为window或undefined在严格模式，而不是numbers对象，
在这种情况下，simpleGetNumbers()将无法正确返回数组。反之可以</p> <h3 id="tight-context-binding-紧密绑定上下文"><a href="#tight-context-binding-紧密绑定上下文" aria-hidden="true" class="header-anchor">#</a> Tight context binding 紧密绑定上下文</h3> <p>.bind()建立一个永久的上下文链接，并始终保持它。
在使用call、apply、bind改变上下文是不起作用的</p> <p>只有绑定函数的构造函数调用才能改变它，
但这不是推荐的方法（对于构造函数调用，使用普通函数，而不是绑定函数）。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token string">'use strict'</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> one <span class="token operator">=</span> getThis<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
<span class="token comment">// Bound function invocation</span>
<span class="token function">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 1  </span>
<span class="token comment">// Use bound function with .apply() and .call()</span>
one<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// =&gt; 1  </span>
one<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 1  </span>
<span class="token comment">// Bind again</span>
one<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 1  </span>
<span class="token comment">// Call the bound function as a constructor</span>
<span class="token keyword">new</span> <span class="token class-name">one</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; Object  </span>
</code></pre></div><p>只new one()更改绑定函数的上下文，其他类型的调用总是this等于1。</p> <h3 id="polyfillbind"><a href="#polyfillbind" aria-hidden="true" class="header-anchor">#</a> polyfillBind</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">polyfillBind</span> <span class="token punctuation">(</span>fn<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">boundFn</span> <span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> l <span class="token operator">=</span> arguments<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token keyword">return</span> l
      <span class="token operator">?</span> l <span class="token operator">&gt;</span> <span class="token number">1</span>
        <span class="token operator">?</span> fn<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span>
        <span class="token punctuation">:</span> fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">,</span> a<span class="token punctuation">)</span>
      <span class="token punctuation">:</span> fn<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  boundFn<span class="token punctuation">.</span>_length <span class="token operator">=</span> fn<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
  <span class="token keyword">return</span> boundFn
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">nativeBind</span> <span class="token punctuation">(</span>fn<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fn<span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span>ctx<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> <span class="token function-variable function">bind</span> <span class="token operator">=</span> Function<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>bind
  <span class="token operator">?</span> nativeBind
  <span class="token punctuation">:</span> polyfillBind<span class="token punctuation">;</span>
</code></pre></div><h3 id="箭头函数"><a href="#箭头函数" aria-hidden="true" class="header-anchor">#</a> 箭头函数</h3> <p>引入箭头函数有两个方面的作用：更简短的函数并且不绑定this。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">hello</span> <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
  <span class="token keyword">return</span> <span class="token string">'Hello '</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">hello</span><span class="token punctuation">(</span><span class="token string">'World'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'Hello World'  </span>
<span class="token comment">// Keep only even numbers</span>
<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>item <span class="token operator">=&gt;</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; [2, 6]</span>
</code></pre></div><p>箭头函数带来较轻的语法，不包括详细的关键字function。return当函数只有1个语句时，你甚至可以省略。
箭头函数是匿名的，这意味着该name属性是一个空字符串''。(函数字面量声明的时候)
它也不提供与arguments常规函数相对的对象</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> <span class="token function-variable function">sumArguments</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
   console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">typeof</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'undefined'</span>
   <span class="token keyword">return</span> args<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> item<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> result <span class="token operator">+</span> item<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
sumArguments<span class="token punctuation">.</span>name      <span class="token comment">// =&gt; ''  </span>
<span class="token function">sumArguments</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 16  </span>
</code></pre></div><h3 id="箭头函数功能"><a href="#箭头函数功能" aria-hidden="true" class="header-anchor">#</a> 箭头函数功能</h3> <p><code>this是定义箭头函数的封闭上下文</code></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span>  
  <span class="token function">constructor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">=</span> x<span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>y <span class="token operator">=</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> myPoint<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> myPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment">// =&gt; true</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>x <span class="token operator">+</span> <span class="token string">':'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; '95:165'</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> myPoint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Point</span><span class="token punctuation">(</span><span class="token number">95</span><span class="token punctuation">,</span> <span class="token number">165</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
myPoint<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
</code></pre></div><p>如果在此示例中尝试使用常规函数，则会创建自己的上下文（window或undefined在严格模式下）。</p> <p>因此，要使相同的代码与函数表达式一起正常工作，必须手动绑定上下文：setTimeout(function() {...}.bind(this))。这很冗长，使用箭头功能是一种更简洁的解决方案。</p> <p>箭头函数一劳永逸地与词汇上下文绑定。this 即使使用上下文修改方法也无法修改：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> numbers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>  
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">var</span> <span class="token function-variable function">get</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> numbers<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; [1, 2]</span>
  <span class="token comment">// Use arrow function with .apply() and .call()</span>
  <span class="token keyword">get</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// =&gt; [1, 2]</span>
  <span class="token keyword">get</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; [1, 2]</span>
  <span class="token comment">// Bind</span>
  <span class="token keyword">get</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; [1, 2]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>numbers<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>函数表达式是间接调用的.call(numbers)，这使得this调用成为numbers。该get箭头函数this为numbers过，因为它需要上下文词汇。</p> <p>无论如何get调用，箭头函数始终保持初始上下文numbers。与其他上下文间接调用，get.call([0])或. get.apply([0])重新绑定get.bind([0])()无效。</p> <p>箭头函数不能用作构造函数。如果将其作为构造函数调用new get()，则JavaScript会抛出错误：TypeError: get is not a constructor。</p> <h3 id="陷阱：用箭头函数定义方法"><a href="#陷阱：用箭头函数定义方法" aria-hidden="true" class="header-anchor">#</a> 陷阱：用箭头函数定义方法</h3> <p>示例使用箭头函数定义format()类上的方法Period：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Period</span> <span class="token punctuation">(</span>hours<span class="token punctuation">,</span> minutes<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span>hours <span class="token operator">=</span> hours<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>minutes <span class="token operator">=</span> minutes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Period<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">format</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> window<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hours <span class="token operator">+</span> <span class="token string">' hours and '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minutes <span class="token operator">+</span> <span class="token string">' minutes'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> walkPeriod <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Period</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
walkPeriod<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; 'undefined hours and undefined minutes'  </span>
</code></pre></div><p>箭头函数在声明的时候会绑定静态上下文</p> <p>函数表达式解决了这个问题，因为常规函数确实根据调用改变了它的上下文：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Period</span> <span class="token punctuation">(</span>hours<span class="token punctuation">,</span> minutes<span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  <span class="token keyword">this</span><span class="token punctuation">.</span>hours <span class="token operator">=</span> hours<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>minutes <span class="token operator">=</span> minutes<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
Period<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">format</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span> <span class="token operator">===</span> walkPeriod<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; true</span>
  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>hours <span class="token operator">+</span> <span class="token string">' hours and '</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>minutes <span class="token operator">+</span> <span class="token string">' minutes'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> walkPeriod <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Period</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  
walkPeriod<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// =&gt; '2 hours and 30 minutes'  </span>
</code></pre></div><div class="language-tip extra-class"><pre class="language-text"><code>
	函数体内的this对象，就是定义时所在的对象，而不是使用时所在的对象。

		this指向的固定化,导致内部的this就是外层代码块的this
</code></pre></div><p>// http://es6.ruanyifeng.com/#docs/function#%E7%AE%AD%E5%A4%B4%E5%87%BD%E6%95%B0</p> <h2 id="new运算符"><a href="#new运算符" aria-hidden="true" class="header-anchor">#</a> new运算符</h2> <p>MDN中的讲解
<code>new运算符创建一个用户定义(Foo、Car等自定义)的对象类型的实例或具有构造函数的内置对象(Function、Object、String等)的实例</code></p> <p>我们从浏览器控制台中可以看出来</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">let</span> myCar <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Car</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>

<span class="token keyword">let</span> myObj <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//</span>
<span class="token template-string"><span class="token string">`

分别console出myCar、myObj可以看出来，他们两个生成的对象不同的是myCar生成的对象中间还嵌套了一层__proto__,它的属性constructor是指向Car这个函数的引用。
也就是说
myCar.constructor === Car;
Car.prototype.constructor === Car；

&gt; 通过上面我们可以得出
&gt;&gt; 创建了一个全新的对象。
&gt;&gt; 继承了构造函数的原型对象,即Foo.prototype,obj.__proto__ = Foo.prototype


描述
&gt; 创建一个用户自定义的对象需要两步
&gt;&gt; 通过编写函数来定义对象类型（比如创建一个汽车的对象类型，这个类型叫做Car,function Car(){}）
&gt;&gt; 通过new来创建对象实例(比如 let mycar = new Car())

当代码new Foo(){}执行时，会发生：
&gt; 一个继承自Foo.prototype的新对象被创建；（一个新对象被创建并且继承了构造函数的原型对象,即Foo.prototype,obj.__proto__ = Foo.prototype）
&gt; 使用指定的参数调用构造函数Foo,并将this绑定到新创建的对象。（使用call函数即可完成,）
&gt; 有构造函数返回的对象就是new表达式的结果。如果构造函数没有显示返回一个对象，则使用步骤1创建的对象

### 课外

new” 关键字在 JavaScript 中有什么作用

`</span></span><span class="token template-string"><span class="token string">``</span></span> bash


<span class="token keyword">var</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> 创建一个空对象obj

obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> co<span class="token punctuation">.</span>prototype 将这个空对象的隐式原型__proto__成员指向了构造函数对象的prototype成员对象，这是最关键的一步，具体细节将在下文描述。
此时变建立的obj对象的原型链
obj<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> co<span class="token punctuation">.</span>prototype
co<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> Object<span class="token punctuation">.</span>prototype
Object<span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token keyword">null</span>

co<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span> 将构造函数的作用域赋给新对象，因此co函数中的<span class="token keyword">this</span>指向了新对象obj，立即执行co函数。<span class="token punctuation">[</span>实例会对构造函数的这些属性进行拷贝出一份副本，然后将其归属为当前实例<span class="token punctuation">]</span>

<span class="token keyword">return</span> obj 返回新对象obj
</code></pre></div><h2 id="结论"><a href="#结论" aria-hidden="true" class="header-anchor">#</a> 结论</h2> <p>参考资料</p> <p><a href="https://dmitripavlutin.com/gentle-explanation-of-this-in-javascript/" target="_blank" rel="noopener noreferrer">https://dmitripavlutin.com/gentle-explanation-of-this-in-javascript/<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/blog/js-variable-lift.html" class="prev">
          let会被提升吗
        </a></span> <span class="next"><a href="/blog/js-function-prototype.html">
          js原型
        </a>
        →
      </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6a1c7d67.js" defer></script><script src="/assets/js/2.63e202d5.js" defer></script><script src="/assets/js/8.00ec34fe.js" defer></script>
  </body>
</html>
